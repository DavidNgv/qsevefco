"use strict";angular.module("yoQsevefco2App",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngMaterial","hmTouchEvents"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/home",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/presqu-accident/:presId",{templateUrl:"views/presqu-accident.html",controller:"PresquAccidentCtrl"}).when("/audit-qse",{templateUrl:"views/audit-qse.html",controller:"AuditQseCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","dbService",function(a,b,c){a.username="",a.isLogined=!1,a.hideDisconnect=!0,a.logout=function(){a.loggedUser=null,a.isLogined=!1,b.path("/login")},a.$on("$routeChangeStart",function(c,d,e){null==a.loggedUser&&("view/login.html"==d.templateUrl||b.path("/"))}),c.dbDef(),c.dbInit().then(function(a){})}]);var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};(isMobile.Android()||isMobile.iOS())&&document.write("<script src=cordova.js></script>"),angular.module("yoQsevefco2App").controller("MainCtrl",["$rootScope","$scope","$location",function(a,b,c){b.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.hideDisconnect=!1,b.gotoPresqu=function(){c.path("/presqu-accident/0")},b.gotoAuditQse=function(){c.path("/audit-qse")}}]),angular.module("yoQsevefco2App").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("yoQsevefco2App").controller("LoginCtrl",["$rootScope","$scope","$location",function(a,b,c){b.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.hideDisconnect=!1,b.user={username:"DavidNgv.Nguyen",password:"123456"},b.login=function(){var d=b.user;a.loggedUser=d,a.username=d.username,a.isLogined=!0,c.path("/home")}}]),angular.module("yoQsevefco2App").controller("PresquAccidentCtrl",["$rootScope","$scope","$location","$routeParams","dbService","$mdToast","$mdSidenav",function(a,b,c,d,e,f,g){if(b.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],b.closeSidenav=function(){g("left").close()},b.openSidenav=function(){g("left").open()},b.toggleLeft=function(){g("left").toggle()},b.loadFromDatabase=function(a){var c=b,d=e.getDb();d.Presquaccidents.find(a).then(function(a){for(var b=a.Image1,d=b.split("|"),e=[],f=0;f<d.length;f++)e.push({path:d[f]});c.$apply(function(){c.presqu={date:a.ReportDate,lieu:a.Lieu,desc:a.Desc,action:a.Action},c.imageInfo=e})},function(a){console.log(a.message)})},b.savePres=function(){var a=b;0==a.presId?a.insertRecord():a.editRecord(a.presId)},b.editRecord=function(a){var c=b,d=e.getDb();d.Presquaccidents.find(a).then(function(a){d.Presquaccidents.attach(a),a.ReportDate=c.presqu.date,a.Lieu=c.presqu.lieu,a.Desc=c.presqu.desc,a.Action=c.presqu.action,d.saveChanges().then(function(){f.show(f.simple().content("Envoyeur").hideDelay(500)),setTimeout(function(){c.$apply(function(){c.goHome()})},700)})})},b.insertRecord=function(){for(var a=b,c=e.getDb(),d="",g=a.imageInfo.length,h=0;g>h;h++){var i=a.imageInfo[h].path;""!=d?d+="|"+i:d=i}var j={ReportDate:a.presqu.date,Lieu:a.presqu.lieu,Desc:a.presqu.desc,Action:a.presqu.action,Image1:d},k=new Presquaccident(j);c.add(k),c.saveChanges().then(function(){k.Id;f.show(f.simple().content("Envoyeur").hideDelay(400)),setTimeout(function(){a.$apply(function(){a.goHome()})},700)})},b.loadItemList=function(){var a=e.getDb(),c=b;c.itemList=[],a.Presquaccidents.filter(function(a){return!0}).forEach(function(a){var b={id:a.Id,desc:a.Desc};c.itemList.push(b),a.Id==c.presId&&(c.selected=b)})},b.selectItem=function(a){b.selected=a;var c=a.id;b.goPresqu(c)},b.goHome=function(){c.path("/home")},b.goPresqu=function(a){c.path("/presqu-accident/"+a)},b.takePicturePress=0,b.takePicture=function(){var a={quality:45,destinationType:Camera.DestinationType.FILE_URI,encodingType:Camera.EncodingType.JPEG,sourceType:Camera.PictureSourceType.CAMERA,correctOrientation:!0};b.takePicturePress++,1==b.takePicturePress&&window.navigator.camera.getPicture(b.camOk,function(a){console.log(a)},a)},b.camOk=function(a){b.takePicturePress=0;var c=b;f.show(f.simple().content("Processing image").hideDelay(0)),c.copyImage(a)},b.copyImage=function(a){var c=b;try{async.waterfall([function(b){window.resolveLocalFileSystemURL(a,function(a){var c=a.name;b(!1,a,c)},function(a){b(a,!1)})},function(a,b,c){window.resolveLocalFileSystemURL(cordova.file.dataDirectory,function(d){c(!1,a,b,d)},function(a){c(a,!1)})},function(a,b,c,d){a.copyTo(c,b,function(){d(!1,b)},function(a){d(a,!1)})},function(a,b){navigator.geolocation.getCurrentPosition(function(c){b(!1,a,c)},function(a){b(a,!1)})}],function(a,b,d){if(a)alert(a);else{var e=cordova.file.dataDirectory+b;c.$apply(function(){c.imageInfo.push({path:e,lat:d.coords.latitude,"long":d.coords.longitude})}),f.hide()}})}catch(d){alert(d.message),f.hide()}},a.hideDisconnect=!0,a.moduleName="Presqu'accident",b.loadItemList(),b.presId=d.presId,b.presId>0)b.loadFromDatabase(b.presId);else{var h=new Date;b.presqu={date:h,lieu:"",desc:"",action:""},b.imageInfo=[]}}]),angular.module("yoQsevefco2App").service("dbService",["$q",function(a){var b;return{dbDef:function(){$data.Entity.extend("Presquaccident",{Id:{type:"int",key:!0,computed:!0},ReportDate:{type:Date},Lieu:{type:String,required:!0,maxLength:100},Desc:{type:String,required:!0,maxLength:255},Action:{type:String,required:!0,maxLength:255},Image1:{type:String}}),$data.EntityContext.extend("QseVefcoDatabase",{Presquaccidents:{type:$data.EntitySet,elementType:Presquaccident}})},dbInit:function(){var c=a.defer();return b=new QseVefcoDatabase("QseVefcoDatabase"),b.onReady(function(){console.log("db ready to use"),c.resolve(b)}),c.promise},getDb:function(){return b}}}]),angular.module("yoQsevefco2App").controller("AuditQseCtrl",["$rootScope","$scope","$location","$routeParams","dbService","$mdToast",function(a,b,c,d,e,f){b.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],b.audit={},b.responsableAffaireList=[{id:1,label:"One"},{id:2,label:"Two"}],b.dureeList=[{id:1,label:"Moins de 1 mois"},{id:2,label:"De 1 à 3 mois"},{id:3,label:"De 3 à 12 mois"},{id:4,label:"plus de 12 mois"}],b.collaborateurList=[{id:1,label:"collaborateur Mr A"},{id:2,label:"collaborateur Mr B"},{id:3,label:"collaborateur Mr C"},{id:4,label:"collaborateur Mr D"}],b.diffusionList=[{id:1,label:"Mr A diffusion"},{id:2,label:"Mr B diffusion"},{id:3,label:"Mr C diffusion"},{id:4,label:"Mr D diffusion"}],b.selectedDiffuse=[],b.fruitNames=["Apple","Banana","Orange"],b.goHome=function(){c.path("/home")},b.$watch("audit.collaborateur",function(){0==b.audit.collaborateur&&(console.log(b.audit.collaborateur),b.showCollaborateurAutre=!0),b.audit.collaborateur>0&&console.log(b.audit.collaborateur)},!0),b.$watch("audit.diffusion",function(){console.log(b.audit.diffusion);var a=b.audit.diffusion;a>0&&angular.forEach(b.diffusionList,function(c){a==c.id&&(b.selectedDiffuse.push(c),b.audit.diffusion=0)})},!0),b.showCollaborateurAutre=!1}]);